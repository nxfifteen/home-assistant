---
sensor:
- platform: rest
  name: gitlab_252_rest
  resource: !secret gitlab_url_project_252
  value_template: '{{ value_json.last_activity_at }}'
  json_attributes:
    - name_with_namespace
    - archived
    - created_at
    - open_issues_count
    - star_count
    - forks_count
    - statistics

  headers:
    PRIVATE-TOKEN: !secret gitlab_token
    Content-Type: application/json
    User-Agent: Home Assistant REST sensor

- platform: template
  sensors:
    gitlab_252_pipeline_master_duration:
      value_template: "{{ state_attr('sensor.gitlab_252_pipeline_master', 'duration') }}"
      entity_id: sensor.gitlab_252_pipeline_master
      friendly_name: 'Pipeline Master Duration'

    gitlab_252_pipeline_develop_duration:
      value_template: "{{ state_attr('sensor.gitlab_252_pipeline_develop', 'duration') }}"
      entity_id: sensor.gitlab_252_pipeline_develop
      friendly_name: 'Pipeline Dev Duration'

    gitlab_252_issues:
      value_template: "{{ state_attr('sensor.gitlab_252_rest', 'open_issues_count') }}"
      entity_id: sensor.gitlab_252_rest
      friendly_name: 'Issues'

    gitlab_252_forks:
      value_template: "{{ state_attr('sensor.gitlab_252_rest', 'forks_count') }}"
      entity_id: sensor.gitlab_252_rest
      friendly_name: 'Forks'

    gitlab_252_stars:
      value_template: "{{ state_attr('sensor.gitlab_252_rest', 'star_count') }}"
      entity_id: sensor.gitlab_252_rest
      friendly_name: 'Stars'

    gitlab_252_commits:
      value_template: "{{ states.sensor.gitlab_252_rest.attributes.statistics.commit_count }}"
      entity_id: sensor.gitlab_252_rest
      friendly_name: 'Commits'

    gitlab_252_size:
      value_template: "{{ states.sensor.gitlab_252_rest.attributes.statistics.repository_size }}"
      entity_id: sensor.gitlab_252_rest
      friendly_name: 'Size'

homeassistant:
  customize:
    sensor.gitlab_252_rest:
      friendly_name: 'Home-Assistant.io'
      icon: mdi:home-assistant
    sensor.gitlab_252_push_master:
      friendly_name: HA Pushes to Master
      icon: mdi:directions-fork
    sensor.gitlab_252_pipeline_master:
      friendly_name: HA Master Pipeline
      icon: mdi:directions-fork

    sensor.gitlab_252_push_develop:
      friendly_name: HA Pushes to Develop
      icon: mdi:directions-fork
    sensor.gitlab_252_pipeline_develop:
      friendly_name: HA Develop Pipeline
      icon: mdi:directions-fork

    sensor.gitlab_252_merge_request_develop_master:
      friendly_name: HA Merge Dev->Mast
      icon: mdi:directions-fork
    sensor.gitlab_252_merge_request_master_develop:
      friendly_name: HA Merge Mast->Dev
      icon: mdi:directions-fork

    sensor.gitlab_252_issues:
      friendly_name: 'Issues'
      icon: mdi:exclamation
    sensor.gitlab_252_forks:
      friendly_name: 'Forks'
      icon: mdi:directions-fork
    sensor.gitlab_252_stars:
      friendly_name: 'Stars'
      icon: mdi:star-four-points
    sensor.gitlab_252_commits:
      friendly_name: 'Commits'
      icon: mdi:source-branch