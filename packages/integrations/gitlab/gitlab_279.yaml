---
sensor:
- platform: rest
  name: gitlab_279_rest
  resource: !secret gitlab_url_project_279
  value_template: '{{ value_json.last_activity_at }}'
  json_attributes:
    - name_with_namespace
    - archived
    - created_at
    - open_issues_count
    - star_count
    - forks_count
    - statistics

  headers:
    PRIVATE-TOKEN: !secret gitlab_token
    Content-Type: application/json
    User-Agent: Home Assistant REST sensor

- platform: template
  sensors:
    gitlab_279_pipeline_master_duration:
      value_template: "{{ state_attr('sensor.gitlab_279_pipeline_master', 'duration') }}"
      entity_id: sensor.gitlab_279_pipeline_master
      friendly_name: 'Pipeline Master Duration'

    gitlab_279_pipeline_develop_duration:
      value_template: "{{ state_attr('sensor.gitlab_279_pipeline_develop', 'duration') }}"
      entity_id: sensor.gitlab_279_pipeline_develop
      friendly_name: 'Pipeline Dev Duration'

    gitlab_279_build_master_ha_latest_duration:
      value_template: "{{ state_attr('sensor.gitlab_279_build_master_ha_latest', 'duration') }}"
      entity_id: sensor.gitlab_279_build_master_ha_latest
      friendly_name: 'Build Master Latest Duration'

    gitlab_279_build_master_ha_rc_duration:
      value_template: "{{ state_attr('sensor.gitlab_279_build_master_ha_rc', 'duration') }}"
      entity_id: sensor.gitlab_279_build_master_ha_rc
      friendly_name: 'Build Master RC Duration'

    gitlab_279_build_develop_ha_latest_duration:
      value_template: "{{ state_attr('sensor.gitlab_279_build_develop_ha_latest', 'duration') }}"
      entity_id: sensor.gitlab_279_build_develop_ha_latest
      friendly_name: 'Build Dev Latest Duration'

    gitlab_279_build_develop_ha_rc_duration:
      value_template: "{{ state_attr('sensor.gitlab_279_build_develop_ha_rc', 'duration') }}"
      entity_id: sensor.gitlab_279_build_develop_ha_rc
      friendly_name: 'Build Dev RC Duration'

    gitlab_279_issues:
      value_template: "{{ state_attr('sensor.gitlab_279_rest', 'open_issues_count') }}"
      entity_id: sensor.gitlab_279_rest
      friendly_name: 'Issues'

    gitlab_279_forks:
      value_template: "{{ state_attr('sensor.gitlab_279_rest', 'forks_count') }}"
      entity_id: sensor.gitlab_279_rest
      friendly_name: 'Forks'

    gitlab_279_stars:
      value_template: "{{ state_attr('sensor.gitlab_279_rest', 'star_count') }}"
      entity_id: sensor.gitlab_279_rest
      friendly_name: 'Stars'

    gitlab_279_commits:
      value_template: "{{ states.sensor.gitlab_279_rest.attributes.statistics.commit_count }}"
      entity_id: sensor.gitlab_279_rest
      friendly_name: 'Commits'

    gitlab_279_size:
      value_template: "{{ states.sensor.gitlab_279_rest.attributes.statistics.repository_size }}"
      entity_id: sensor.gitlab_279_rest
      friendly_name: 'Size'

homeassistant:
  customize:
    sensor.gitlab_279_rest:
      friendly_name: 'Home-Assistant.io'
      icon: mdi:home-assistant
    sensor.gitlab_279_push_master:
      friendly_name: HA Pushes to Master
      icon: mdi:directions-fork
    sensor.gitlab_279_pipeline_master:
      friendly_name: HA Master Pipeline
      icon: mdi:directions-fork
    sensor.gitlab_279_build_master_ha_latest:
      friendly_name: HA Master Build
      icon: mdi:powershell
    sensor.gitlab_279_build_master_ha_rc:
      friendly_name: HA Master Build RC
      icon: mdi:powershell

    sensor.gitlab_279_push_develop:
      friendly_name: HA Pushes to Develop
      icon: mdi:directions-fork
    sensor.gitlab_279_pipeline_develop:
      friendly_name: HA Develop Pipeline
      icon: mdi:directions-fork
    sensor.gitlab_279_build_develop_ha_latest:
      friendly_name: HA Develop Build
      icon: mdi:powershell
    sensor.gitlab_279_build_develop_ha_rc:
      friendly_name: HA Develop Build RC
      icon: mdi:powershell

    sensor.gitlab_279_merge_request_develop_master:
      friendly_name: HA Merge Dev->Mast
      icon: mdi:directions-fork
    sensor.gitlab_279_merge_request_master_develop:
      friendly_name: HA Merge Mast->Dev
      icon: mdi:directions-fork

    sensor.gitlab_279_issues:
      friendly_name: 'Issues'
      icon: mdi:exclamation
    sensor.gitlab_279_forks:
      friendly_name: 'Forks'
      icon: mdi:directions-fork
    sensor.gitlab_279_stars:
      friendly_name: 'Stars'
      icon: mdi:star-four-points
    sensor.gitlab_279_commits:
      friendly_name: 'Commits'
      icon: mdi:source-branch