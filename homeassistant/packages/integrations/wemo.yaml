---
# https://www.home-assistant.io/components/wemo/
wemo:
  discovery: false
  static:
    - !secret wemo_static_switch_1
    - !secret wemo_static_switch_2
    - !secret wemo_static_switch_3

input_boolean:
  disable_washing_machine_notification:
    name: Disable Washing Machine Notification
    initial: off
    icon: mdi:washing-machine  
    
  disable_dishwasher_notification:
    name: Disable dishwasher Notification
    initial: off
    icon: mdi:dishwasher

input_select:
  washing_machine_status:
    name: Washing Machine Status
    options:
      - Idle
      - Running
      - Finishing
      - Clean
    initial: Idle

  dishwasher_status:
    name: dishwasher Status
    options:
      - Idle
      - Running
      - Finishing
      - Clean
    initial: Idle

# sensor:

#   - platform: template
#     sensors:
#       ## Washing Machine Status
#       washing_machine_status:
#         value_template: '{{ states.input_select.washing_machine_status.state}}'
#         friendly_name: 'Washing Machine Status'
#       ## Washing Machine Power Usage
#       waching_machine_power:
#         value_template: '{{ states.switch.dishwasher.attributes.current_power_w|int }}'  
#         friendly_name: 'Washing Machine Power' 
#       ## Washer Power Graph
#       waching_machine_load:
#         value_template: 'Power: {{ states.switch.washing_machine.attributes.current_power_w|int }}'  
#         friendly_name: 'Washer Power' 
#         unit_of_measurement: 'W'
#       ## Washer Status
#       clothes_washer_status:
#         value_template: 'Washer: {{ states.input_select.washing_machine_status.state}}'
#         friendly_name: 'Washing Machine Status'
    
#       ## dishwasher Status
#       dishwasher_status:
#         value_template: '{{ states.input_select.dishwasher_status.state}}'
#         friendly_name: 'dishwasher Status'
#       ## dishwasher Power Usage
#       dishwasher_power:
#         value_template: '{{ states.switch.dishwasher.attributes.current_power_w|default(0)|int }}'  
#         friendly_name: 'dishwasher Power'
#       ## dishwasher Power Graph
#       dishwasher_load:
#         value_template: 'Power: {{ states.switch.washing_machine.attributes.current_power_w|default(0)|int }}'  
#         friendly_name: 'dishwasher Power'  
#         unit_of_measurement: 'W'   
#       ## dishwasher Status
#       dish_washer_status:
#         value_template: 'dishwasher: {{ states.input_select.dishwasher_status.state}}'
#         friendly_name: 'dishwasher Status' 

homeassistant:
  customize:
    switch.dishwasher:
      friendly_name: Dishwasher
      icon: mdi:dishwasher
      initial_state: on
      
    sensor.dishwasher_status:
      friendly_name: Dishwasher Status
      icon: mdi:dishwasher
      
    sensor.dishwasher_power:
      friendly_name: Dishwasher Power
      
    switch.washing_machine:
      friendly_name: Washing Machine
      icon: mdi:washing-machine
      initial_state: on
      
    sensor.washing_machine_status:
      friendly_name: Washing Machine Status
      icon: mdi:washing-machine
      
    sensor.washing_machine_power:
      friendly_name: Washing Machine Power

# automation:
#   - alias: Set dryer active when power detected
#     trigger:
#       - platform: numeric_state
#         entity_id: switch.dishwasher
#         value_template: '{{ state.attributes.current_power_w }}'
#         above: 10
#     condition:
#       condition: or
#       conditions:
#         - condition: state
#           entity_id: sensor.dishwasher_status
#           state: Idle
#         - condition: state
#           entity_id: sensor.dishwasher_status
#           state: Clean
#         - condition: state
#           entity_id: sensor.dishwasher_status
#           state: Finishing
#     action:
#       - service: input_select.select_option
#         data:
#           entity_id: input_select.dishwasher_status
#           option: Running
          
# ## When the power drops, move the state of the dryer to
# ## Finishing.

#   - alias: Set dryer finished when power drops
#     trigger:
#       - platform: numeric_state
#         entity_id: switch.dishwasher
#         value_template: '{{ state.attributes.current_power_w }}'
#         below: 6
#     condition:
#       condition: and
#       conditions:
#         - condition: state
#           entity_id: input_select.dishwasher_status
#           state: Running
#     action:
#       - service: input_select.select_option
#         data:
#           entity_id: input_select.dishwasher_status
#           option: Finishing
          
# ## Wait 1 minutes for us to be in the Finishing state before we
# ## decide the dryer has finished. This way, if the
# ## dryer is in between cycles and the power drops, we
# ## won't mark the dryer cycle as finished too early.

#   - alias: Set dryer clean after timeout
#     trigger:
#       - platform: state
#         entity_id: input_select.dishwasher_status
#         to: Finishing
#         for:
#           minutes: 1
#     condition:
#       condition: and
#       conditions:
#         - condition: state
#           entity_id: input_select.dishwasher_status
#           state: Finishing
#     action:
#       - service: input_select.select_option
#         data:
#           entity_id: input_select.dishwasher_status
#           option: Clean

# ## Dryer Alerts
#   - alias: Send alert when dryer is finished
#     trigger:
#       - platform: state
#         entity_id: sensor.dishwasher_status
#         to: Clean
#         for:
#           minutes: 1
#       - platform: state
#         entity_id: person.stuart
#         to: 'home'
#         for:
#           minutes: 2
#       - platform: state
#         entity_id: person.kareen
#         to: 'home'
#         for:
#           minutes: 2
#       - platform: time
#         at: '20:45:00'
#     condition:
#       condition: and
#       conditions:
#         - condition: time
#           before: '21:00:00'
#           after: '08:30:00'
#         - condition: state
#           entity_id: group.people_family
#           state: 'home'
#         - condition: state
#           entity_id: input_select.dishwasher_status
#           state: Clean
#         - condition: state
#           entity_id: input_boolean.disable_dryer_notification
#           state: 'off'
#         - condition: template
#           value_template: >
#             {% if states.automation.send_alert_when_washing_machine_is_finished.last_triggered is not none %}
#               {% if as_timestamp(now()) | int   -  as_timestamp(states.automation.send_alert_when_washing_machine_is_finished.attributes.last_triggered) | int > 1800 %} true {% else %} false
#               {% endif %}
#             {% else %}
#             false
#             {% endif %}
#     action:
#       - service: notify.synchat_tts
#         data_template:
#           message: "The dryer has finished and is ready to be emptied"