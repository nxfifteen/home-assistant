---
alias: gitlab_ci_failure
trigger:
  platform: state
  entity_id:
  - sensor.gitlab_252_ci
  - sensor.gitlab_274_ci
  - sensor.gitlab_279_ci
  to: 'success'
  
condition:
  - condition: state
    entity_id: sensor.family_stuart_state
    state: 'Home'
  
action:
  - service: notify.synchat_nx
    data_template:
      message: "GitLab validation testing has passed for {{ trigger.to_state.attributes.friendly_name }}. #GitLab #CI"
    
  - service: light.turn_on
    data:
      entity_id: light.ff_study_wall
      rgb_color: [81, 255, 76]
      brightness: 254

  - service: notify.alexa_media
    data:
      target: 
        - media_player.study
      data:
        type: announce
      message: "GitLab validation testing has passed for {{ trigger.to_state.attributes.friendly_name }}."