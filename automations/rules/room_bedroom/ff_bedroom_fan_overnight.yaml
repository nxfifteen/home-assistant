---
# ## Turn off Fan after 20 minutes
alias: Bedroom Overnight Fan
trigger:
  - platform: time_pattern
    minutes: '/120'
    seconds: 00
    
condition:
  condition: and
  conditions:
    - condition: numeric_state
      entity_id: sensor.family_family_state_raw
      above: 6
    - condition: time
      after: '23:00:00'
    - condition: numeric_state
      entity_id: sensor.ff_bedroom_sensor_temperature
      above: 20

action:
    - service: switch.turn_on
      data:
        entity_id: switch.ff_bedroom_fan_switch
      
    - service: script.notify_join
      data_template:
        who: "stuart"
        title: 'Too Hot'
        notification_id: "hass-parking-his"
        value1: "I've turned on the bedroom fan"

    - delay: "00:20:00"
      
    - service: script.notify_join
      data_template:
        who: "stuart"
        title: 'Too Hot'
        notification_id: "hass-parking-his"
        value1: "I've turned off the bedroom fan"

    - service: switch.turn_off
      data:
        entity_id: switch.ff_bedroom_fan_switch