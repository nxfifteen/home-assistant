---
# ## Fan Before Bed
alias: Bedroom Too Hot Fan
trigger:
  - platform: numeric_state
    entity_id: sensor.ff_bedroom_sensor_temperature
    above: 21
    for:
      minutes: 5

  - platform: time
    at: '21:00:00'
    
condition:
  condition: and
  conditions:
    - condition: time
      before: '23:00:00'
      after: '20:30:00'

    - condition: numeric_state
      entity_id: sensor.ff_bedroom_sensor_temperature
      above: 21
      
    - condition: numeric_state
      entity_id: sensor.family_family_state_raw
      below: 7

    - condition: state
      entity_id: group.people_family
      state: 'home'

action:
    - service: switch.turn_on
      data:
        entity_id: switch.ff_bedroom_fan
      
    - service: script.notify_join
      data_template:
        who: "stuart"
        title: 'Too Hot'
        notification_id: "hass-parking-his"
        value1: "I've turned on the bedroom fan"