---
alias: Set washing machine active when power detected
trigger:
  - platform: numeric_state
    entity_id: switch.washing_machine
    value_template: '{{ state.attributes.current_power_w }}'
    above: 10
condition:
  condition: or
  conditions:
    - condition: state
      entity_id: sensor.washing_machine_status
      state: Idle
    - condition: state
      entity_id: sensor.washing_machine_status
      state: Clean
    - condition: state
      entity_id: sensor.washing_machine_status
      state: Finishing
action:
  - service: input_select.select_option
    data:
      entity_id: input_select.washing_machine_status
      option: Running

  - service: shell_command.grocy_consume_item
    data:
      server_ip: !secret grocy_url
      grocy_key: !secret grocy_api_key
      product_id: 6
      amount: 40

  - service: shell_command.grocy_consume_item
    data:
      server_ip: !secret grocy_url
      grocy_key: !secret grocy_api_key
      product_id: 7
      amount: 80

  - service: script.notify_join
    data_template:
      who: "stuart"
      title: 'Appliances'
      value1: 'The washing machine is on'