---
image: docker:latest

stages:
  - preflight
  - test

# Generic preflight template
.preflight: &preflight
  stage: preflight
  tags:
    - preflight

# Generic Home Assistant template
.ha: &ha
  variables:
    PYTHONPATH: "/usr/src/app:$PYTHONPATH"
  before_script:
    - python -m homeassistant --version
    - mv  secrets.dist  secrets.yaml
  script:
    - |
      python -m homeassistant \
        --config ./ \
        --script check_config
  tags:
    - docker

# Home Assistant test jobs
ha-latest:
  <<: *ha
  stage: test
  image:
    name: homeassistant/home-assistant:latest
    entrypoint: [""]

ha-rc:
  <<: *ha
  stage: test
  image:
    name: homeassistant/home-assistant:rc
    entrypoint: [""]
  allow_failure: true

ha-installed:
  <<: *ha
  stage: test
  image:
    name: homeassistant/home-assistant:0.101.3
    entrypoint: [""]
  allow_failure: true

# ha-dev:
#   <<: *ha
#   stage: test
#   image:
#     name: homeassistant/home-assistant:dev
#     entrypoint: [""]
#   allow_failure: true

