---
image: docker:latest

stages:
  - preflight
  - test

# Generic preflight template
.preflight: &preflight
  stage: preflight
  tags:
    - preflight

# Generic Home Assistant template
.ha: &ha
  variables:
    PYTHONPATH: "/usr/src/app:$PYTHONPATH"
  before_script:
    - python -m homeassistant --version
    - mv  homeassistant/secrets.dist  homeassistant/secrets.yaml
  script:
    - |
      python -m homeassistant \
        --config ./homeassistant/ \
        --script check_config
  tags:
    - test

# Home Assistant test jobs
ha-latest:
  <<: *ha
  stage: test
  image:
    name: homeassistant/home-assistant:latest
    entrypoint: [""]

ha-rc:
  <<: *ha
  stage: test
  image:
    name: homeassistant/home-assistant:rc
    entrypoint: [""]
  allow_failure: true

ha-dev:
  <<: *ha
  stage: test
  image:
    name: homeassistant/home-assistant:dev
    entrypoint: [""]
  allow_failure: true

